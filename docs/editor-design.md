# ã‚¨ãƒ‡ã‚£ã‚¿ç·¨é›†ç”»é¢ è¨­è¨ˆæ›¸

## æ¦‚è¦

oneamlog CMSã®ãƒ–ãƒ­ã‚°è¨˜äº‹ç·¨é›†ç”»é¢ã¯ã€Milkdown Crepe WYSIWYGã‚¨ãƒ‡ã‚£ã‚¿ã‚’æ¡ç”¨ã—ã€ç›´æ„Ÿçš„ãªMarkdownç·¨é›†ä½“é¨“ã‚’æä¾›ã—ã¾ã™ã€‚æœ¬æ–‡æ›¸ã¯ã€ã‚¨ãƒ‡ã‚£ã‚¿ç”»é¢ã®æŠ€è¡“ä»•æ§˜ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®šç¾©ã—ã¾ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PostEditor Component                      â”‚
â”‚                  (Hono JSX Server-Side)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   åŸºæœ¬æƒ…å ±   â”‚  â”‚ WYSIWYG      â”‚  â”‚  ã‚¿ã‚°ãƒ»æ“ä½œ      â”‚   â”‚
â”‚  â”‚   ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â”‚  â”‚ ã‚¨ãƒ‡ã‚£ã‚¿     â”‚  â”‚  ã‚»ã‚¯ã‚·ãƒ§ãƒ³      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Client-Side Components                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        Milkdown Crepe Editor (client/src/editor.ts)   â”‚   â”‚
â”‚  â”‚                                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ WYSIWYG Pane â”‚ â†syncâ†’ â”‚ Markdown Source Pane  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚         â†“                           â†“                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚    Hidden Form Textarea (#content)             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚    â†’ POST /api/posts ã¾ãŸã¯ PUT /api/posts/:id â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

#### 1. åˆæœŸåŒ–ãƒ•ãƒ­ãƒ¼

```
1. ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰: PostEditor TSX ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
   â†“
2. ãƒ–ãƒ©ã‚¦ã‚¶: /dist/editor.js èª­ã¿è¾¼ã¿ (Vite ãƒ“ãƒ«ãƒ‰æˆæœç‰©)
   â†“
3. window.initMilkdownEditor() åˆæœŸåŒ–å¾…æ©Ÿ
   â†“
4. Crepe ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆ
   - æ—¢å­˜ã® content textarea ã‹ã‚‰åˆæœŸå€¤ã‚’èª­ã¿å–ã‚Š
   - ã‚¨ãƒ‡ã‚£ã‚¿æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ï¼ˆCodeMirror, ListItem, ImageBlock, etc.ï¼‰
   â†“
5. crepe.create() ã§ã‚¨ãƒ‡ã‚£ã‚¿ã‚’ãƒã‚¦ãƒ³ãƒˆ
   â†“
6. listener.markdownUpdated() ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸé–‹å§‹
```

#### 2. ç·¨é›†ãƒ•ãƒ­ãƒ¼ï¼ˆWYSIWYG â†’ Markdownï¼‰

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ› (WYSIWYG)
   â†“
crepe.on(listener => listener.markdownUpdated())
   â†“
crepe.getMarkdown() ã§æœ€æ–°ã®Markdownå–å¾—
   â†“
åŒæœŸå‡¦ç†:
  - markdown-source textarea ã«åæ˜  (èª­ã¿å–ã‚Šå°‚ç”¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼)
  - content textarea ã«åæ˜  (ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ç”¨ã€éè¡¨ç¤º)
```

#### 3. ãƒˆã‚°ãƒ«è¡¨ç¤ºãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: "ğŸ“„ Markdown ã‚½ãƒ¼ã‚¹è¡¨ç¤º" ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
   â†“
isSourceVisible = true
   â†“
CSS Grid ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´:
  - grid-template-columns: '1fr' â†’ '1fr 1fr'
  - source-pane: display: none â†’ display: flex
   â†“
ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´: "âœ• Markdown ã‚½ãƒ¼ã‚¹éè¡¨ç¤º"
```

#### 4. ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: "ä½œæˆ" ã¾ãŸã¯ "æ›´æ–°" ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
   â†“
ãƒ•ã‚©ãƒ¼ãƒ  POST/PUT:
  - title, slug, excerpt, status, content (Markdown)
   â†“
ã‚µãƒ¼ãƒãƒ¼: /api/posts ã¾ãŸã¯ /api/posts/:id
   â†“
ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ â†’ Supabase posts ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
   â†“
ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ: /admin (ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰)
```

## UI/UX è¨­è¨ˆ

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹æˆ

#### 1. åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (`.editor-basic-info`)

- **ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›** (`#title`)
  - å¿…é ˆé …ç›®
  - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼: "è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«"

- **ã‚¹ãƒ©ãƒƒã‚° & ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹** (`.form-row` - 2ã‚«ãƒ©ãƒ )
  - ã‚¹ãƒ©ãƒƒã‚° (`#slug`): å°æ–‡å­—è‹±æ•°å­—ã¨ãƒã‚¤ãƒ•ãƒ³ã®ã¿ã€å¿…é ˆ
  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (`#status`): ä¸‹æ›¸ã / å…¬é–‹

- **æŠœç²‹** (`#excerpt`)
  - ä»»æ„é …ç›®ã€2è¡Œã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢

#### 2. ã‚¨ãƒ‡ã‚£ã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (`.form-group`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ¬æ–‡ * (Markdown)    [ğŸ“„ Markdown ã‚½ãƒ¼ã‚¹è¡¨ç¤º]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ WYSIWYG ã‚¨ãƒ‡ã‚£ã‚¿                              â”‚ â”‚
â”‚  â”‚                                                â”‚ â”‚
â”‚  â”‚  (Milkdown Crepe)                             â”‚ â”‚
â”‚  â”‚  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼                      â”‚ â”‚
â”‚  â”‚  - ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ (å¤ªå­—ã€æ–œä½“ã€ãƒªã‚¹ãƒˆã€ã‚³ãƒ¼ãƒ‰ç­‰)   â”‚ â”‚
â”‚  â”‚  - ç”»åƒ D&D ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†“ ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯å¾Œ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœ¬æ–‡ * (Markdown)    [âœ• Markdown ã‚½ãƒ¼ã‚¹éè¡¨ç¤º]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WYSIWYG ã‚¨ãƒ‡ã‚£ã‚¿         â”‚ Markdown ã‚½ãƒ¼ã‚¹          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          â”‚ # è¦‹å‡ºã—                 â”‚
â”‚  (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼) â”‚                          â”‚
â”‚                          â”‚ æœ¬æ–‡ãƒ†ã‚­ã‚¹ãƒˆ...          â”‚
â”‚                          â”‚ (èª­ã¿å–ã‚Šå°‚ç”¨)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. ãƒ•ãƒƒã‚¿ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (`.editor-footer`)

- **ã‚¿ã‚°ã‚»ã‚¯ã‚·ãƒ§ãƒ³** (`.editor-tags-section`)
  - æ—¢å­˜ã‚¿ã‚°ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ä¸€è¦§
  - ã‚¿ã‚°ãŒæœªç™»éŒ²ã®å ´åˆã¯èª˜å°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

- **æ“ä½œãƒœã‚¿ãƒ³** (`.editor-buttons`)
  - ä½œæˆ/æ›´æ–°ãƒœã‚¿ãƒ³ (`.btn-primary`)
  - å…¬é–‹ãƒšãƒ¼ã‚¸ã‚’è¦‹ã‚‹ (ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ & å…¬é–‹æ¸ˆã¿ã®å ´åˆã®ã¿)
  - å‰Šé™¤ãƒœã‚¿ãƒ³ (ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®ã¿ã€ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä»˜ã)

### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ

- **ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— (1200pxä»¥ä¸Š)**
  - ã‚µã‚¤ãƒ‰ãƒãƒ¼: ãƒ›ãƒãƒ¼ã§å±•é–‹ (60px â†’ 250px)
  - ã‚¨ãƒ‡ã‚£ã‚¿: æœ€å¤§å¹…ã§è¡¨ç¤º
  - åˆ†å‰²ãƒ“ãƒ¥ãƒ¼: 1:1 ã®å‡ç­‰é…ç½®

- **ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ (768px - 1199px)**
  - ã‚µã‚¤ãƒ‰ãƒãƒ¼: å¸¸æ™‚å±•é–‹
  - ã‚¨ãƒ‡ã‚£ã‚¿: ã‚„ã‚„ç‹­ã„å¹…
  - åˆ†å‰²ãƒ“ãƒ¥ãƒ¼: ç¸¦ç©ã¿è¡¨ç¤ºã«å¤‰æ›´

- **ãƒ¢ãƒã‚¤ãƒ« (767pxä»¥ä¸‹)**
  - ã‚µã‚¤ãƒ‰ãƒãƒ¼: ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼åŒ–
  - ã‚¨ãƒ‡ã‚£ã‚¿: å…¨å¹…è¡¨ç¤º
  - åˆ†å‰²ãƒ“ãƒ¥ãƒ¼: å®Œå…¨ã«ç¸¦ç©ã¿ã€ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ¨å¥¨

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| Milkdown Crepe | 7.18.0 | WYSIWYG Markdown ã‚¨ãƒ‡ã‚£ã‚¿ |
| @milkdown/core | 7.18.0 | Milkdown ã‚³ã‚¢ã‚¨ãƒ³ã‚¸ãƒ³ |
| @milkdown/preset-commonmark | 7.18.0 | CommonMark ã‚µãƒãƒ¼ãƒˆ |
| @milkdown/preset-gfm | 7.18.0 | GitHub Flavored Markdown |
| @milkdown/plugin-listener | 7.18.0 | Markdownå¤‰æ›´ç›£è¦– |
| @milkdown/plugin-upload | 7.18.0 | ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |
| Vite | 7.3.1 | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ãƒ“ãƒ«ãƒ‰ |

### ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰

| æŠ€è¡“ | ç”¨é€” |
|------|------|
| Hono JSX | PostEditor ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° |
| Cloudflare Workers | ã‚¨ãƒƒã‚¸ã§ã®ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹å®Ÿè¡Œ |

## æ©Ÿèƒ½ä»•æ§˜

### 1. WYSIWYGã‚¨ãƒ‡ã‚£ã‚¿æ©Ÿèƒ½

#### æœ‰åŠ¹åŒ–ã•ã‚ŒãŸ Crepe Features

```typescript
features: {
  [Crepe.Feature.CodeMirror]: true,      // ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  [Crepe.Feature.ListItem]: true,        // ãƒªã‚¹ãƒˆæ“ä½œ
  [Crepe.Feature.BlockEdit]: true,       // ãƒ–ãƒ­ãƒƒã‚¯ç·¨é›†
  [Crepe.Feature.Placeholder]: true,     // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¡¨ç¤º
  [Crepe.Feature.Cursor]: true,          // ã‚«ãƒ¼ã‚½ãƒ«åˆ¶å¾¡
  [Crepe.Feature.Toolbar]: true,         // ãƒ„ãƒ¼ãƒ«ãƒãƒ¼
  [Crepe.Feature.LinkTooltip]: true,     // ãƒªãƒ³ã‚¯ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
  [Crepe.Feature.Listener]: true,        // å¤‰æ›´ç›£è¦–
  [Crepe.Feature.ImageBlock]: {...}      // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
}
```

#### ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ Markdown è¨˜æ³•

- **è¦‹å‡ºã—**: `# H1` ~ `###### H6`
- **å¼·èª¿**: `**å¤ªå­—**`, `*æ–œä½“*`
- **ãƒªã‚¹ãƒˆ**: `- ç®‡æ¡æ›¸ã`, `1. ç•ªå·ä»˜ã`
- **ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯**: ` ```è¨€èªå` `
- **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰**: `` `code` ``
- **ãƒªãƒ³ã‚¯**: `[ãƒ†ã‚­ã‚¹ãƒˆ](URL)`
- **ç”»åƒ**: `![alt](URL)` + D&D ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- **å¼•ç”¨**: `> å¼•ç”¨æ–‡`
- **æ°´å¹³ç·š**: `---`
- **ãƒ†ãƒ¼ãƒ–ãƒ«**: GFMå½¢å¼ã‚µãƒãƒ¼ãƒˆ
- **æ‰“ã¡æ¶ˆã—ç·š**: `~~å‰Šé™¤~~` (GFM)

### 2. ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

#### ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç”»åƒã‚’ã‚¨ãƒ‡ã‚£ã‚¿ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
   â†“
2. Crepe.Feature.ImageBlock ã® onUpload ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç™ºç«
   â†“
3. uploadImage(file) é–¢æ•°å®Ÿè¡Œ
   - FormData ã«ç”»åƒã‚’æ·»ä»˜
   - POST /api/upload/image
   â†“
4. ã‚µãƒ¼ãƒãƒ¼å´ã§ Supabase Storage ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   - ãƒã‚±ãƒƒãƒˆ: blog-images
   - ãƒ‘ã‚¹: public/{filename}
   â†“
5. å…¬é–‹ URL ã‚’è¿”å´
   â†“
6. ã‚¨ãƒ‡ã‚£ã‚¿ã« ![alt](URL) ã‚’æŒ¿å…¥
```

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—æ™‚: `alert()` ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥
- ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼å‡ºåŠ›: `console.error('Upload failed:', error)`

### 3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸæ©Ÿèƒ½

#### åŒæœŸå¯¾è±¡

| è¦ç´  | ID | ç”¨é€” | ç·¨é›†å¯å¦ |
|------|-----|------|---------|
| WYSIWYGã‚¨ãƒ‡ã‚£ã‚¿ | `#editor` | ãƒ¡ã‚¤ãƒ³ç·¨é›†é ˜åŸŸ | âœ… |
| Markdownã‚½ãƒ¼ã‚¹ | `#markdown-source` | ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º | âŒ (èª­ã¿å–ã‚Šå°‚ç”¨) |
| ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ç”¨ | `#content` | POST/PUTç”¨ | âŒ (éè¡¨ç¤º) |

#### åŒæœŸãƒ­ã‚¸ãƒƒã‚¯

```typescript
// WYSIWYG â†’ Markdown Source ã¸ã®ä¸€æ–¹å‘åŒæœŸ
crepe.on((listener) => {
  listener.markdownUpdated(() => {
    const markdown = crepe.getMarkdown();

    // åŒæœŸå…ˆ
    markdownSource.value = markdown;  // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
    contentTextarea.value = markdown; // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ç”¨
  });
});
```

**æ³¨æ„**: Markdownã‚½ãƒ¼ã‚¹ã‹ã‚‰ WYSIWYGã¸ã®é€†åŒæœŸã¯ã€Crepe APIã®åˆ¶ç´„ã«ã‚ˆã‚Šæœªå®Ÿè£…ï¼ˆ`setMarkdown()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ãªã„ï¼‰ã€‚

### 4. ãƒˆã‚°ãƒ«è¡¨ç¤ºæ©Ÿèƒ½

#### çŠ¶æ…‹ç®¡ç†

```typescript
let isSourceVisible = false;  // åˆæœŸçŠ¶æ…‹: éè¡¨ç¤º

toggleBtn.addEventListener('click', () => {
  isSourceVisible = !isSourceVisible;

  if (isSourceVisible) {
    // åˆ†å‰²ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    sourcePane.style.display = 'flex';
    editorContainer.style.gridTemplateColumns = '1fr 1fr';
    toggleBtn.textContent = 'âœ• Markdown ã‚½ãƒ¼ã‚¹éè¡¨ç¤º';
  } else {
    // WYSIWYG ã®ã¿è¡¨ç¤º
    sourcePane.style.display = 'none';
    editorContainer.style.gridTemplateColumns = '1fr';
    toggleBtn.textContent = 'ğŸ“„ Markdown ã‚½ãƒ¼ã‚¹è¡¨ç¤º';
  }
});
```

#### CSS ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³

```css
.editor-split-view {
  display: grid;
  grid-template-columns: 1fr;  /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: å…¨å¹… */
  transition: grid-template-columns 0.3s ease;
}
```

### 5. ã‚µã‚¤ãƒ‰ãƒãƒ¼æŠ˜ã‚ŠãŸãŸã¿æ©Ÿèƒ½

#### ãƒ›ãƒãƒ¼å±•é–‹

```css
.admin-sidebar {
  width: 60px;
  transition: width 0.3s ease;
}

.admin-sidebar:hover {
  width: 250px;
}
```

#### ãƒ¡ãƒªãƒƒãƒˆ

- ã‚¨ãƒ‡ã‚£ã‚¿é ˜åŸŸã‚’æœ€å¤§190pxæ‹¡å¼µ
- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¯å¿…è¦æ™‚ã®ã¿è¡¨ç¤º
- ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. XSS å¯¾ç­–

- Markdown â†’ HTML å¤‰æ›æ™‚ã« DOMPurify ã§ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆå…¬é–‹ã‚µã‚¤ãƒˆå´ï¼‰
- ã‚¨ãƒ‡ã‚£ã‚¿å†…ã§ã¯ç”Ÿã®Markdownã‚’ä¿å­˜ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ï¼‰

### 2. CSRF å¯¾ç­–

- Hono ã® CSRF ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ä½¿ç”¨ï¼ˆäºˆå®šï¼‰
- ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã«ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼

### 3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯¾ç­–

- è¨±å¯ã™ã‚‹ç”»åƒå½¢å¼: PNG, JPG, GIF, WebP
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™: 5MBä»¥ä¸‹
- ãƒ•ã‚¡ã‚¤ãƒ«åã®ã‚µãƒ‹ã‚¿ã‚¤ã‚º
- Supabase Storage ã® RLS (Row Level Security) ã§ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

### 4. èªè¨¼ãƒ»èªå¯

- `/admin/*` ãƒ«ãƒ¼ãƒˆã¯ authMiddleware ã§ä¿è­·
- Cookie ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† (HttpOnly, Secure)
- Supabase Auth ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œè¨¼

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ã‚³ãƒ¼ãƒ‰åˆ†å‰²

- Vite ã«ã‚ˆã‚‹è‡ªå‹•ã‚³ãƒ¼ãƒ‰åˆ†å‰²
- ã‚¨ãƒ‡ã‚£ã‚¿ã‚³ãƒ¼ãƒ‰ (`editor.js`) ã‚’ç‹¬ç«‹ã—ãŸãƒãƒ£ãƒ³ã‚¯åŒ–
- ç®¡ç†ç”»é¢ã§ã®ã¿èª­ã¿è¾¼ã¿ï¼ˆå…¬é–‹ã‚µã‚¤ãƒˆã«ã¯å½±éŸ¿ãªã—ï¼‰

### 2. é…å»¶èª­ã¿è¾¼ã¿

- ã‚¨ãƒ‡ã‚£ã‚¿åˆæœŸåŒ–ã‚’éåŒæœŸå‡¦ç†
- `await new Promise()` ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…æ©Ÿ

### 3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã®æœ€é©åŒ–

- ãƒ•ãƒ©ã‚°ã«ã‚ˆã‚‹ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢:
  - `isUpdatingFromSource`
  - `isUpdatingFromEditor`

### 4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

- é™çš„ã‚¢ã‚»ãƒƒãƒˆ (`/dist/*`) ã®é•·æœŸã‚­ãƒ£ãƒƒã‚·ãƒ¥
- `?v=${Date.now()}` ã«ã‚ˆã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼ˆé–‹ç™ºæ™‚ï¼‰

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. ã‚¨ãƒ‡ã‚£ã‚¿ãŒåˆæœŸåŒ–ã•ã‚Œãªã„

**ç—‡çŠ¶**: `window.initMilkdownEditor is not a function`

**åŸå› **: Vite ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®èª­ã¿è¾¼ã¿ã‚¿ã‚¤ãƒŸãƒ³ã‚°

**è§£æ±ºç­–**:
```typescript
await new Promise(resolve => {
  const checkInterval = setInterval(() => {
    if (window.initMilkdownEditor) {
      clearInterval(checkInterval);
      resolve();
    }
  }, 100);
});
```

#### 2. MarkdownåŒæœŸãŒå‹•ä½œã—ãªã„

**ç—‡çŠ¶**: WYSIWYG ã§å…¥åŠ›ã—ã¦ã‚‚Markdownã‚½ãƒ¼ã‚¹ãŒæ›´æ–°ã•ã‚Œãªã„

**åŸå› **: `Crepe.Feature.Listener` ãŒæœªæœ‰åŠ¹åŒ–

**è§£æ±ºç­–**:
```typescript
features: {
  [Crepe.Feature.Listener]: true,  // å¿…é ˆï¼
}
```

#### 3. ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒå¤±æ•—ã™ã‚‹

**ç—‡çŠ¶**: `alert('ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ')`

**ç¢ºèªäº‹é …**:
- Supabase Storage ã® `blog-images` ãƒã‚±ãƒƒãƒˆãŒå­˜åœ¨ã™ã‚‹ã‹
- RLS ãƒãƒªã‚·ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
- `/api/upload/image` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‹

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### Phase 1: åŸºæœ¬æ©Ÿèƒ½å¼·åŒ–

- [ ] ãƒ‰ãƒ©ãƒ•ãƒˆè‡ªå‹•ä¿å­˜ (LocalStorage)
- [ ] ç·¨é›†å±¥æ­´ï¼ˆUndo/Redoï¼‰ã®æ”¹å–„
- [ ] ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆæ‹¡å……

### Phase 2: ãƒªãƒƒãƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¯¾å¿œ

- [ ] å‹•ç”»åŸ‹ã‚è¾¼ã¿ (YouTube, Vimeo)
- [ ] ãƒ„ã‚¤ãƒ¼ãƒˆåŸ‹ã‚è¾¼ã¿
- [ ] ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒ†ãƒ¼ãƒé¸æŠ

### Phase 3: ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…±åŒç·¨é›† (WebSocket)
- [ ] ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½
- [ ] å¤‰æ›´å±¥æ­´ãƒ»å·®åˆ†è¡¨ç¤º

### Phase 4: AI ã‚¢ã‚·ã‚¹ãƒˆ

- [ ] AI æ–‡ç« æ ¡æ­£
- [ ] ã‚¿ã‚¤ãƒˆãƒ«ææ¡ˆ
- [ ] ã‚¿ã‚°è‡ªå‹•æŠ½å‡º

## å‚è€ƒè³‡æ–™

- [Milkdown å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://milkdown.dev/)
- [Crepe ãƒ†ãƒ¼ãƒã‚¬ã‚¤ãƒ‰](https://milkdown.dev/docs/guide/using-crepe)
- [CommonMark ä»•æ§˜](https://commonmark.org/)
- [GitHub Flavored Markdown](https://github.github.com/gfm/)
